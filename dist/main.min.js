!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["easy-log-report"]=t():e["easy-log-report"]=t()}(self,(()=>(()=>{"use strict";var e,t,n={d:(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};n.r(o),n.d(o,{default:()=>l}),function(e){e[e.EMERGENCY=0]="EMERGENCY",e[e.ALERT=1]="ALERT",e[e.CRITICAL=2]="CRITICAL",e[e.ERROR=3]="ERROR",e[e.WARNING=4]="WARNING",e[e.NOTICE=5]="NOTICE",e[e.INFORMATIONAL=6]="INFORMATIONAL",e[e.DEBUG=7]="DEBUG"}(e||(e={})),function(e){e.IMG="img",e.BEACON="beacon"}(t||(t={}));var r=function(){return r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};const s=function(){function e(e){this.isConsuming=!1,this.eventQueue=[];var t=e.sendInterval,n=e.sendQueueSize,o=e.singleMode,r=e.reportCreator,s=e.sender;this.sendInterval=t,this.sendQueueSize=n,this.singleMode=o,this.reportCreator=r,this.sender=s}return e.prototype.begin=function(){var e=this,t=setInterval((function(){e.eventQueue.length>0&&e.consume()}),this.sendInterval);return this.sendTimer=t,t},e.prototype.end=function(){this.sendTimer&&clearInterval(this.sendTimer)},e.prototype.push=function(e){if(this.singleMode)return this.eventQueue.push(e),void this.consume();this.eventQueue.length>=this.sendQueueSize&&this.consume(),this.eventQueue.push(e)},e.prototype.consume=function(){if(!this.isConsuming){this.isConsuming=!0;var e=this.eventQueue.slice(0);this.eventQueue=[],this.isConsuming=!1,this.sender.send(r({items:e},this.reportCreator()))}},e}(),i=function(){function e(e){var t=e.getCurrentPage;this.getCurrentPage=t,this.stack=[]}return e.prototype.push=function(){this.stack.push(this.getCurrentPage())},e.prototype.pop=function(){this.stack.pop()},e.prototype.getCurrentStack=function(){var e=this.stack;return e[e.length-1]},e}();var u=function(e,t){var n=new Image;n.src=t+"/"+encodeURIComponent(JSON.stringify(e)),n.onerror=function(){console.error("EasyLogReport - log data send from image src error")}},a=function(e,t){(null===navigator||void 0===navigator?void 0:navigator.sendBeacon)?navigator.sendBeacon(t,encodeURIComponent(JSON.stringify(e))):console.error("EasyLogReport - current env don't support sendBeacon!")};const p=function(){function e(e){var n,o=this,r=e.sendUrl,s=e.sendType,i=e.sendFn;if(this.sendUrl=r,this.strategy=((n={})[t.IMG]=u,n[t.BEACON]=a,n),this.sendType=s,"function"==typeof i)this.sendFn=i;else if(s&&null!=this.sendUrl){var p=this.strategy[s];p?this.sendFn=function(e){p(e,o.sendUrl||"")}:(console.error("EasyLogReport - no strategy for ".concat(s," typeÔºÅUsing beacon by default")),this.sendFn=function(e){a(e,o.sendUrl||"")})}else console.error("EasyLogReport - missing sendFn, sendType or sendUrl"),this.sendFn=function(e){console.error("EasyLogReport - missing sendFn, sendType or sendUrl")}}return e.prototype.send=function(e){this.sendFn(e)},e}(),c={acceptEventType:["onLaunch","onLoad","onUnload","onShow","request","onError","click"],sendInterval:3e4,sendQueueSize:50,singleMode:!1};var d=function(){return d=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},d.apply(this,arguments)},h={};const l=function(){function t(e){this.reportOptions=d(d({},c),e||{})}return t.prototype.init=function(e){var t=this.reportCreator,n=this.reportOptions,o=n.sendInterval,r=n.sendQueueSize,u=n.singleMode,a=n.sendFn,c=n.getCurrentPage,d=n.sendUrl,l=n.sendType,f=n.getInitialEventContent;this.sender=new p({sendUrl:d,sendType:l,sendFn:a}),this.queue=new s({sendInterval:o,sendQueueSize:r,singleMode:u,reportCreator:t,sender:this.sender}),u||this.queue.begin(),this.stack=new i({getCurrentPage:c}),h=f?f():{},e&&e()},t.prototype.log=function(t,n){var o=t.eventType;if(n=n||e.NOTICE,-1===this.reportOptions.acceptEventType.indexOf(o))return console.warn("EasyLogReport - unregister event");"onLoad"===o&&this.stack.push();var r=d(d({},t),{logLevel:n,path:this.stack.getCurrentStack()});"onUnload"===o&&this.stack.pop(),r.createTime||(r.createTime=String(Date.now())),this.queue.push(r)},t.prototype.warn=function(t){this.log(t,e.WARNING)},t.prototype.error=function(t){this.log(t,e.ERROR)},t.prototype.debug=function(t){this.log(t,e.DEBUG)},t.prototype.reportCreator=function(){return d(d({},h),{reportTime:String(Date.now())})},t.prototype.updateInitialEventContent=function(e){var t=e.key,n=e.value;h[t]=n},t.prototype.getInitialEventContent=function(){return h},t}();return o})()));